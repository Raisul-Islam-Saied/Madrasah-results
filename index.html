<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abdur Razzaq Dakhil Madrasah - Result System v2.0</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');

    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#111827;
      --brand:#0f766e;
      --brand2:#064e3b;
      --accent:#2563eb;
      --warn:#f59e0b;
      --danger:#dc2626;
      --ok:#16a34a;
      --line:#e5e7eb;
      --shadow: 0 12px 35px rgba(17,24,39,.10);
      --shadow2: 0 8px 20px rgba(17,24,39,.08);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    body{
      font-family:'Hind Siliguri',sans-serif;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(15,118,110,.10), transparent 60%),
        radial-gradient(900px 500px at 90% 20%, rgba(37,99,235,.10), transparent 55%),
        var(--bg);
      margin:0;
      padding:18px;
      color:var(--text);
    }

    .wrap{max-width: 980px; margin: 0 auto;}

    /* Top Hero Header */
    .hero{
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      border-radius: 22px;
      padding: 22px 18px;
      color:#fff;
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-60px -80px auto auto;
      width:260px;
      height:260px;
      background: radial-gradient(circle, rgba(255,255,255,.22), transparent 60%);
      transform: rotate(20deg);
      filter: blur(2px);
    }
    .hero-top{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .hero h1{ margin:0; font-size: 28px; line-height:1.15; letter-spacing:.2px; }
    .hero p{ margin:6px 0 0; opacity:.92; font-size: 14px; }
    .hero-right{ text-align:right; min-width: 220px; }
    .hero-right small{ display:block; opacity:.9; font-size: 12px; }

    /* App Card */
    .card{
      margin-top: 14px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      border: 1px solid rgba(229,231,235,.85);
      overflow:hidden;
    }
    .card-head{
      padding: 16px 18px;
      background: linear-gradient(180deg, rgba(15,118,110,.06), rgba(15,118,110,0));
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .steps{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .step-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      font-weight:700;
      font-size: 13px;
    }
    .step-pill.active{
      border-color: rgba(15,118,110,.35);
      background: rgba(15,118,110,.08);
      color: var(--brand2);
    }
    .step-pill .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--line);
    }
    .step-pill.active .dot{
      background: var(--brand);
      box-shadow: 0 0 0 4px rgba(15,118,110,.12);
    }
    
    .card-body{ padding: 18px; }
    .hidden{ display:none; }

    h3{
      margin:0 0 10px;
      font-size: 18px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .hbar{
      width:10px;height:22px;border-radius: 6px;
      background: linear-gradient(180deg, var(--brand), var(--accent));
    }
    .subtext{
      margin:0 0 14px;
      font-size: 13px;
      color: var(--muted);
    }

    /* Form Styles for Step 1 */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        font-weight: 700;
        margin-bottom: 6px;
        font-size: 14px;
    }
    .form-select, .form-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--line);
        border-radius: 10px;
        font-size: 15px;
        outline: none;
        background: #fff;
        font-family: inherit;
    }
    .form-select:focus, .form-input:focus {
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(15,118,110,.1);
    }

    /* Subject selection cards */
    .subject-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .sub-card{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(15,118,110,.06), rgba(255,255,255,0));
      transition: .18s ease;
    }
    .sub-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(17,24,39,.08);
      border-color: rgba(15,118,110,.22);
    }
    .sub-row{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .sub-label{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 700;
      color: #0b1220;
      cursor:pointer;
      user-select:none;
    }
    .sub-label input{
      transform: scale(1.25);
      accent-color: var(--brand);
      cursor:pointer;
    }
    .fm-wrap{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-end;
      min-width: 86px;
    }
    .fm-input{
      width: 86px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      border-radius: 10px;
      font-weight: 700;
      text-align: center;
      outline:none;
      background:#fff;
      transition:.15s;
    }
    .fm-input:focus{
      border-color: rgba(37,99,235,.45);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }

    /* Student Info Box */
    .student-info-box {
        background: linear-gradient(135deg, #1e293b, #0f172a);
        color: white;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    .st-details h2 { margin: 0; font-size: 20px; }
    .st-details p { margin: 2px 0 0; opacity: 0.8; font-size: 14px; }
    .st-roll {
        background: rgba(255,255,255,0.1);
        padding: 5px 12px;
        border-radius: 8px;
        font-weight: 700;
        text-align: center;
    }
    .st-roll span { display: block; font-size: 11px; opacity: 0.7; }
    .st-roll strong { font-size: 18px; }

    /* Buttons */
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }
    .btn{
      border:none;
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 800;
      cursor:pointer;
      color:#fff;
      transition:.18s ease;
      box-shadow: 0 10px 22px rgba(17,24,39,.10);
    }
    .btn:active{ transform: scale(.99); }
    .btn:hover{ transform: translateY(-1px); }

    .btn-primary{ background: linear-gradient(135deg, var(--brand), var(--brand2)); }
    .btn-accent{ background: linear-gradient(135deg, #db2777, #9d174d); }
    .btn-muted{ background: linear-gradient(135deg, #64748b, #334155); }
    .btn-add{ background: linear-gradient(135deg, #0284c7, #1d4ed8); }
    .btn-warn{ background: linear-gradient(135deg, #f59e0b, #d97706); color:#111827; }
    .btn-danger{ background: linear-gradient(135deg, #ef4444, #b91c1c); }
    .btn-small{ padding: 9px 12px; border-radius: 10px; font-size: 14px; box-shadow:none; }

    /* Marks table */
    .marks-table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
      background:#fff;
    }
    .marks-table th{
      background: linear-gradient(135deg, rgba(15,118,110,.14), rgba(37,99,235,.10));
      color:#0b1220;
      text-align:left;
      font-weight: 900;
      padding: 12px 12px;
      border-bottom: 1px solid var(--line);
      font-size: 14px;
    }
    .marks-table td{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      vertical-align: middle;
      font-size: 15px;
    }
    .marks-table tr:last-child td{ border-bottom:none; }
    .input-mark{
      width: 100%;
      padding: 12px 12px;
      border: 1px solid var(--line);
      border-radius: 12px;
      font-size: 16px;
      font-weight: 800;
      outline:none;
      transition:.15s;
      background:#fff;
    }
    .input-mark:focus{
      border-color: rgba(15,118,110,.45);
      box-shadow: 0 0 0 4px rgba(15,118,110,.12);
      background: rgba(15,118,110,.04);
    }

    /* Result card */
    #result-area{
      display:none;
      margin-top: 14px;
      border-radius: 16px;
      padding: 16px;
      border: 1px solid rgba(22,163,74,.22);
      background: linear-gradient(180deg, rgba(22,163,74,.07), rgba(255,255,255,.0));
    }
    /* Merit table section */
    #merit-list-section{
      display:none;
      margin-top: 18px;
      border-top: 1px dashed rgba(107,114,128,.45);
      padding-top: 14px;
    }
    .section-title{
      text-align:center;
      margin:0 0 10px;
      color:#0b1220;
      font-size: 18px;
      font-weight: 1000;
    }
    .table-responsive{
      overflow:auto;
      border:1px solid var(--line);
      border-radius: 14px;
      background:#fff;
    }
    .list-table{
      width:100%;
      border-collapse: collapse;
      text-align:center;
      min-width: 900px;
    }
    .list-table th{
      position: sticky;
      top: 0;
      z-index: 1;
      background: #0b1220;
      color:#fff;
      padding: 10px 10px;
      font-size: 13px;
      border: 1px solid #0b1220;
      white-space: nowrap;
    }
    .list-table td{
      border: 1px solid var(--line);
      padding: 10px 8px;
      font-size: 15px;
      white-space: nowrap;
      background:#fff;
    }
    .row-fail td{ background: rgba(220,38,38,.08); color:#7f1d1d; font-weight: 800; }
    .row-pass td{ color:#111827; }
    .hl{ font-weight: 1000; }
    .text-left { text-align: left !important; padding-left: 12px !important; }

    .btn-edit{
      border:none;
      border-radius: 10px;
      padding: 6px 10px;
      cursor:pointer;
      font-weight: 1000;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color:#111827;
      transition:.15s;
    }
    .footer{ margin-top: 14px; text-align:center; color: var(--muted); font-size: 13px; }
    .footer a{ color: var(--brand); text-decoration:none; font-weight: 900; }

    /* Toast (Alert Alternative) */
    .toast {
      position: fixed;
      left: 50%;
      top: 14px;
      transform: translateX(-50%) translateY(-8px);
      background: rgba(17, 24, 39, 0.92);
      color: #fff;
      padding: 12px 14px;
      border-radius: 14px;
      box-shadow: 0 14px 35px rgba(0,0,0,0.25);
      font-size: 14px;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
    .toast.warn { background: rgba(245, 158, 11, 0.92); color: #111827; }
    .toast.success { background: rgba(5, 150, 105, 0.92); }

    /* PRINT */
    @media print{
      @page { margin: 10mm; }
      body{ background:#fff; padding:0; }
      body *{ visibility:hidden; }
      #print-area, #print-area *{ visibility: visible; }
      #print-area{ position:absolute; left:0; top:0; width:100%; }
      .no-print, .action-col { display:none !important; }
      .print-head{
        display:block !important;
        text-align:center;
        margin-bottom: 10px;
      }
      .list-table{ width: 100% !important; font-size: 12px; border-collapse: collapse; }
      .list-table th, .list-table td{ border: 1px solid #000 !important; color:#000 !important; padding: 4px !important;}
      .list-table th{ background: #eee !important; color: #000 !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="hero">
      <div class="hero-top">
        <div>
          <h1>‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶æ‡¶ú‡ßç‡¶ú‡¶æ‡¶ï ‡¶¶‡¶æ‡¶ñ‡¶ø‡¶≤ ‡¶Æ‡¶æ‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡¶æ</h1>
          <p>‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø‡¶ï ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</p>
        </div>
        <div class="hero-right">
          <small>Developed by</small>
          <div style="font-weight:1000;font-size:15px;">Raisul Islam Saied</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="steps">
          <div class="step-pill active" id="pill1"><span class="dot"></span> ‡¶§‡¶•‡ßç‡¶Ø</div>
          <div class="step-pill" id="pill2"><span class="dot"></span> ‡¶¨‡¶ø‡¶∑‡ßü</div>
          <div class="step-pill" id="pill3"><span class="dot"></span> ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</div>
        </div>
      </div>

      <div class="card-body">

        <div id="step1">
          <h3><span class="hbar"></span> ‡¶ß‡¶æ‡¶™ ‡ßß: ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>
          <p class="subtext">‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>

          <div class="form-grid">
             <div class="form-group">
                 <label>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø (Class)</label>
                 <select id="class-select" class="form-select">
                     <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</option>
                     <option value="Class 1">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 2">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 3">‡¶§‡ßÉ‡¶§‡ßÄ‡ßü ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 4">‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶• ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 5">‡¶™‡¶û‡ßç‡¶ö‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 6">‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 7">‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 8">‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 9">‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                     <option value="Class 10">‡¶¶‡¶∂‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                 </select>
             </div>
             <div class="form-group">
                <label>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                <select id="exam-select" class="form-select">
                    <option value="Annual Examination">‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</option>
                    <option value="Half Yearly Exam">‡¶Ö‡¶∞‡ßç‡¶ß-‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</option>
                    <option value="Pre-Test Exam">‡¶™‡ßç‡¶∞‡¶æ‡¶ï-‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</option>
                    <option value="Test Exam">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</option>
                </select>
            </div>
            <div class="form-group">
                <label>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶≤</label>
                <input type="number" id="year-input" class="form-input" value="2025">
            </div>
          </div>

          <div class="btnrow">
            <button class="btn btn-primary" onclick="goToStep2()">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ß‡¶æ‡¶™ (‡¶¨‡¶ø‡¶∑‡ßü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®) &raquo;</button>
          </div>
        </div>

        <div id="step2" class="hidden">
            <div class="btnrow no-print" style="margin-top:0">
                <button class="btn btn-muted btn-small" onclick="backToStep1()">&laquo; ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
            </div>

          <h3><span class="hbar"></span> ‡¶ß‡¶æ‡¶™ ‡ß®: ‡¶¨‡¶ø‡¶∑‡ßü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</h3>
          <p class="subtext">
            ‡¶Ø‡ßá ‡¶¨‡¶ø‡¶∑‡ßü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá ‡¶ü‡¶ø‡¶ï ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶® ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
          </p>

          <div class="subject-grid" id="subject-selection-area"></div>

          <div class="btnrow">
            <button class="btn btn-add" onclick="addNewSubject()">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡ßü ‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>

          <div class="btnrow" style="margin-top:20px">
            <button class="btn btn-primary" onclick="goToStep3()">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ß‡¶æ‡¶™ (‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®) &raquo;</button>
          </div>
        </div>

        <div id="step3" class="hidden">
          <div class="btnrow no-print" style="margin-top:0">
            <button class="btn btn-muted btn-small" onclick="backToStep2()">&laquo; ‡¶¨‡¶ø‡¶∑‡ßü ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          </div>

          <div class="student-info-box" id="student-header">
               <div class="st-details">
                   <h2 id="st-name-display">‡¶®‡¶æ‡¶Æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h2>
                   <p id="exam-info-display">Class - Exam</p>
               </div>
               <div class="st-roll">
                   <span>Roll No</span>
                   <strong id="st-roll-display">00</strong>
               </div>
           </div>

          <table class="marks-table">
            <thead>
              <tr>
                <th style="width: 50%">‡¶¨‡¶ø‡¶∑‡ßü</th>
                <th style="width: 20%; text-align:center;">‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶®</th>
                <th style="width: 30%">‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
              </tr>
            </thead>
            <tbody id="input-rows"></tbody>
          </table>

          <div class="btnrow no-print">
            <button id="next-student-btn" class="btn btn-accent" style="width:100%" onclick="saveAndNext()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ &raquo;</button>
          </div>

          <div id="print-area">
            <div class="print-head" style="display:none">
              <h1 id="p-school">‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶æ‡¶ú‡ßç‡¶ú‡¶æ‡¶ï ‡¶¶‡¶æ‡¶ñ‡¶ø‡¶≤ ‡¶Æ‡¶æ‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡¶æ</h1>
              <h2 id="p-exam-title">‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
              <p id="p-exam-sub">Result Sheet</p>
            </div>

            <div id="merit-list-section">
              <div class="section-title">‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£‡ßÄ</div>
              <div class="table-responsive">
                <table class="list-table" id="final-table">
                  <thead>
                    <tr id="table-headers"></tr>
                  </thead>
                  <tbody id="student-rows"></tbody>
                </table>
              </div>
              <div class="btnrow no-print" style="margin-top:12px;">
                <button class="btn btn-primary" style="flex:1" onclick="downloadExcel()">üì• Excel ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                <button class="btn btn-add" style="flex:1" onclick="window.print()">üñ®Ô∏è PDF / ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
              </div>
               <div class="btnrow no-print">
                <button class="btn btn-danger" style="width:100%;" onclick="resetSystem()">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® (Reset)</button>
              </div>
            </div>
          </div>

        </div>

      </div>
    </div>

    <div class="footer">
      Developed by <a href="https://www.facebook.com/raisulislamsaied" target="_blank">Raisul Islam Saied</a>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
  // DUMMY STUDENT DATA (10 Students)
  const dummyStudents = [
    { roll: 1, name: "‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Ü‡¶≤ ‡¶Æ‡¶æ‡¶Æ‡ßÅ‡¶®" },
    { roll: 2, name: "‡¶Æ‡ßã‡¶É ‡¶∞‡¶æ‡¶ï‡¶ø‡¶¨ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®" },
    { roll: 3, name: "‡¶∏‡¶æ‡ßü‡¶Æ‡¶æ ‡¶Ü‡¶ï‡ßç‡¶§‡¶æ‡¶∞" },
    { roll: 4, name: "‡¶π‡¶æ‡¶∏‡¶æ‡¶® ‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶" },
    { roll: 5, name: "‡¶´‡¶æ‡¶§‡ßá‡¶Æ‡¶æ ‡¶§‡ßÅ‡¶ú ‡¶ú‡ßã‡¶π‡¶∞‡¶æ" },
    { roll: 6, name: "‡¶Æ‡ßã‡¶É ‡¶á‡¶¨‡ßç‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ ‡¶ñ‡¶≤‡¶ø‡¶≤" },
    { roll: 7, name: "‡¶∏‡ßÅ‡¶Æ‡¶æ‡¶á‡ßü‡¶æ ‡¶ú‡¶æ‡¶®‡ßç‡¶®‡¶æ‡¶§" },
    { roll: 8, name: "‡¶Ü‡¶∞‡¶ø‡¶´‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ" },
    { roll: 9, name: "‡¶®‡ßÅ‡¶∏‡¶∞‡¶æ‡¶§ ‡¶ú‡¶æ‡¶π‡¶æ‡¶®" },
    { roll: 10, name: "‡¶ú‡ßÅ‡¶¨‡¶æ‡ßü‡ßá‡¶∞ ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶" }
  ];

  // Global State
  let currentStudentIndex = 0;
  let selectedSubjects = [];
  let studentResults = []; // Stores {roll, name, marks:[], total, gpa...}
  let examInfo = { class: '', name: '', year: '' };
  
  const subjectsDB = [
    { name: '‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶¶', short: 'Quran', def: 100 },
    { name: '‡¶Ü‡¶ï‡¶æ‡¶á‡¶¶ ‡¶ì ‡¶´‡¶ø‡¶ï‡¶π', short: 'Aqaid', def: 100 },
    { name: '‡¶π‡¶æ‡¶¶‡¶ø‡¶∏ ‡¶∂‡¶∞‡ßÄ‡¶´', short: 'Hadith', def: 100 },
    { name: '‡¶Ü‡¶∞‡¶¨‡¶ø ‡ßß‡¶Æ', short: 'Arb-1', def: 100 },
    { name: '‡¶Ü‡¶∞‡¶¨‡¶ø ‡ß®‡ßü', short: 'Arb-2', def: 100 },
    { name: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡ßß‡¶Æ', short: 'Ban-1', def: 100 },
    { name: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡ß®‡ßü', short: 'Ban-2', def: 100 },
    { name: '‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡ßß‡¶Æ', short: 'Eng-1', def: 100 },
    { name: '‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡ß®‡ßü', short: 'Eng-2', def: 100 },
    { name: '‡¶ó‡¶£‡¶ø‡¶§', short: 'Math', def: 100 },
    { name: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ì ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨', short: 'BGS', def: 100 },
    { name: '‡¶Ü‡¶á‡¶∏‡¶ø‡¶ü‡¶ø', short: 'ICT', def: 50 }
  ];

  // --- INITIALIZATION ---
  window.onload = function() {
    renderSubjectCards();
    // Load from local storage if exists (Optional: simplified for this request)
    const saved = localStorage.getItem('madrasah_results_v2');
    if(saved){
        if(confirm("‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")){
           // Logic to restore state could go here
        } else {
            localStorage.removeItem('madrasah_results_v2');
        }
    }
  };

  function showToast(msg, type='warn'){
    const t = document.getElementById('toast');
    t.innerHTML = msg;
    t.className = `toast show ${type}`;
    setTimeout(() => t.classList.remove('show'), 2000);
  }

  function setPill(n){
      document.querySelectorAll('.step-pill').forEach((p, i) => {
          if(i+1 === n) p.classList.add('active');
          else p.classList.remove('active');
      });
  }

  // --- STEP 1 LOGIC ---
  function goToStep2() {
    const cls = document.getElementById('class-select').value;
    const ex = document.getElementById('exam-select').value;
    const yr = document.getElementById('year-input').value;

    if(!cls || !ex || !yr){
        showToast("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!"); 
        return;
    }

    examInfo = { class: cls, name: ex, year: yr };
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.remove('hidden');
    setPill(2);
  }

  function backToStep1(){
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step1').classList.remove('hidden');
    setPill(1);
  }

  // --- STEP 2 LOGIC (Subjects) ---
  function renderSubjectCards() {
    const container = document.getElementById('subject-selection-area');
    container.innerHTML = '';
    subjectsDB.forEach((sub, idx) => {
        const checked = idx < 3 ? 'checked' : '';
        const div = document.createElement('div');
        div.className = 'sub-card';
        div.innerHTML = `
            <div class="sub-row">
                <label class="sub-label">
                    <input type="checkbox" class="sub-check" data-name="${sub.name}" data-short="${sub.short}" ${checked}>
                    <span>${sub.name}</span>
                </label>
                <div class="fm-wrap"><input type="number" class="fm-input" value="${sub.def}"></div>
            </div>`;
        container.appendChild(div);
    });
  }

  function addNewSubject() {
    let name = prompt("‡¶¨‡¶ø‡¶∑‡ßü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ):");
    if(name){
        let short = prompt("Subject Short Name (English):") || name;
        const container = document.getElementById('subject-selection-area');
        const div = document.createElement('div');
        div.className = 'sub-card';
        div.innerHTML = `
            <div class="sub-row">
                <label class="sub-label">
                    <input type="checkbox" class="sub-check" data-name="${name}" data-short="${short}" checked>
                    <span>${name}</span>
                </label>
                <div class="fm-wrap"><input type="number" class="fm-input" value="100"></div>
            </div>`;
        container.appendChild(div);
    }
  }

  function goToStep3() {
    selectedSubjects = [];
    document.querySelectorAll('.sub-card').forEach(card => {
        const cb = card.querySelector('.sub-check');
        const fm = card.querySelector('.fm-input');
        if(cb.checked){
            selectedSubjects.push({
                name: cb.getAttribute('data-name'),
                short: cb.getAttribute('data-short'),
                full: parseInt(fm.value) || 100
            });
        }
    });

    if(selectedSubjects.length === 0){
        showToast("‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶ø‡¶∑‡ßü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!");
        return;
    }

    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step3').classList.remove('hidden');
    setPill(3);

    // Initialize Marks Table
    renderInputTable();
    loadStudentUI(0);
  }

  function backToStep2(){
      if(confirm("‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?")){
        document.getElementById('step3').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
        setPill(2);
        currentStudentIndex = 0;
        studentResults = [];
        document.getElementById('merit-list-section').style.display = 'none';
      }
  }

  // --- STEP 3 LOGIC (Marks Entry) ---
  function renderInputTable(){
      const tbody = document.getElementById('input-rows');
      tbody.innerHTML = '';
      selectedSubjects.forEach((sub, i) => {
          tbody.innerHTML += `
            <tr>
                <td>${sub.name}</td>
                <td style="text-align:center;font-weight:bold">${sub.full}</td>
                <td>
                    <input type="number" class="input-mark" data-idx="${i}" data-full="${sub.full}" placeholder="Mark" onkeydown="focusNext(event, ${i})">
                </td>
            </tr>
          `;
      });
  }

  function loadStudentUI(index){
      currentStudentIndex = index;
      const btn = document.getElementById('next-student-btn');
      
      // Clear Inputs
      document.querySelectorAll('.input-mark').forEach(inp => inp.value = '');
      
      if(index < dummyStudents.length){
          // Show Student Info
          const s = dummyStudents[index];
          document.getElementById('st-name-display').innerText = s.name;
          document.getElementById('st-roll-display').innerText = s.roll;
          document.getElementById('exam-info-display').innerText = `${examInfo.class} | ${examInfo.name} - ${examInfo.year}`;
          
          btn.innerText = "‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ¬ª";
          btn.classList.remove('btn-muted');
          btn.classList.add('btn-accent');
          btn.disabled = false;
          
          // Focus first input
          setTimeout(() => {
              const first = document.querySelector('.input-mark');
              if(first) first.focus();
          }, 100);

          // Check if already edited (for edit mode)
          const existing = studentResults.find(r => r.roll === s.roll);
          if(existing){
               const inputs = document.querySelectorAll('.input-mark');
               existing.marks.forEach((m, i) => { if(inputs[i]) inputs[i].value = m; });
               showToast("‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá", "warn");
          }

      } else {
          // Finished
          document.getElementById('st-name-display').innerText = "‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
          document.getElementById('st-roll-display').innerText = "--";
          btn.innerText = "‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®";
          btn.disabled = true;
          btn.classList.add('btn-muted');
          
          generateMeritList();
      }
  }

  function focusNext(e, i){
      if(e.key === 'Enter'){
          e.preventDefault();
          const inputs = document.querySelectorAll('.input-mark');
          if(i+1 < inputs.length) inputs[i+1].focus();
          else saveAndNext();
      }
  }

  function getGP(m, full){
      let p = (m/full)*100;
      if(p>=80) return 5.00;
      if(p>=70) return 4.00;
      if(p>=60) return 3.50;
      if(p>=50) return 3.00;
      if(p>=40) return 2.00;
      if(p>=33) return 1.00;
      return 0.00;
  }

  function saveAndNext(){
      const inputs = document.querySelectorAll('.input-mark');
      let marksArr = [];
      let totalObt = 0, totalFull = 0, totalGP = 0, failCount = 0;
      let isValid = true;

      inputs.forEach((inp, idx) => {
          let val = parseFloat(inp.value);
          let full = parseFloat(inp.getAttribute('data-full'));
          if(isNaN(val)) { isValid = false; return; }
          if(val > full) { showToast(`‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ!`, 'warn'); isValid = false; return; }
          
          marksArr.push(val);
          totalObt += val;
          totalFull += full;
          
          let gp = getGP(val, full);
          totalGP += gp;
          if(val/full < 0.33) failCount++;
      });

      if(!isValid){ showToast("‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®"); return; }

      // Calculation
      let gpa = (totalGP / inputs.length).toFixed(2);
      if(failCount > 0) gpa = "0.00";
      else if(gpa > 5.00) gpa = "5.00"; // Should not happen with logic but safety

      let grade = "";
      if(failCount > 0) grade = "F";
      else if(gpa == 5.00) grade = "A+";
      else if(gpa >= 4.00) grade = "A";
      else if(gpa >= 3.50) grade = "A-";
      else if(gpa >= 3.00) grade = "B";
      else if(gpa >= 2.00) grade = "C";
      else grade = "D";

      const currentStu = dummyStudents[currentStudentIndex];
      
      const resultObj = {
          roll: currentStu.roll,
          name: currentStu.name,
          marks: marksArr,
          total: totalObt,
          full: totalFull,
          gpa: parseFloat(gpa),
          grade: grade,
          fail: failCount,
          avg: ((totalObt/totalFull)*100).toFixed(2)
      };

      // Remove existing if editing
      studentResults = studentResults.filter(r => r.roll !== currentStu.roll);
      studentResults.push(resultObj);
      
      // Save to LocalStorage
      localStorage.setItem('madrasah_results_v2', JSON.stringify(studentResults));

      showToast("‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success");
      
      // Load Next
      loadStudentUI(currentStudentIndex + 1);
  }

  // --- MERIT LIST & OUTPUT ---
  function generateMeritList(){
      document.getElementById('merit-list-section').style.display = 'block';
      
      // Update Print Header
      document.getElementById('p-exam-title').innerText = `${examInfo.name} - ${examInfo.year}`;
      document.getElementById('p-exam-sub').innerText = `‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø: ${examInfo.class} | ‡¶Æ‡ßá‡¶ß‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ`;

      // Sort: Pass first, then GPA high to low, then Total Marks
      studentResults.sort((a, b) => {
          if(a.fail === 0 && b.fail > 0) return -1;
          if(a.fail > 0 && b.fail === 0) return 1;
          if(b.gpa !== a.gpa) return b.gpa - a.gpa;
          return b.total - a.total;
      });

      const thead = document.getElementById('table-headers');
      let thHTML = `<th>Merit</th><th>Roll</th><th class="text-left">Student Name</th>`;
      selectedSubjects.forEach(s => thHTML += `<th>${s.short}</th>`);
      thHTML += `<th>Total</th><th>GPA</th><th>Grade</th><th class="action-col">Act</th>`;
      thead.innerHTML = thHTML;

      const tbody = document.getElementById('student-rows');
      tbody.innerHTML = '';

      studentResults.forEach((r, idx) => {
          let marksHTML = '';
          r.marks.forEach(m => marksHTML += `<td>${m}</td>`);
          
          let statusClass = r.fail > 0 ? 'row-fail' : 'row-pass';
          let merit = r.fail > 0 ? '--' : (idx+1);

          tbody.innerHTML += `
            <tr class="${statusClass}">
                <td class="hl">${merit}</td>
                <td class="hl">${r.roll}</td>
                <td class="text-left hl" style="min-width:160px">${r.name}</td>
                ${marksHTML}
                <td class="hl">${r.total}</td>
                <td class="hl">${Number(r.gpa).toFixed(2)}</td>
                <td class="hl">${r.grade}</td>
                <td class="action-col">
                    <button class="btn-edit" onclick="editSingle(${r.roll})">Edit</button>
                </td>
            </tr>
          `;
      });
      
      // Scroll to result
      document.getElementById('merit-list-section').scrollIntoView({behavior:'smooth'});
  }

  function editSingle(roll){
      // Find index in dummy list
      const idx = dummyStudents.findIndex(s => s.roll === roll);
      if(idx > -1){
          loadStudentUI(idx);
          document.getElementById('step3').scrollIntoView({behavior:'smooth'});
          showToast(`‡¶∞‡ßã‡¶≤ ${roll} ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`, 'warn');
      }
  }

  function resetSystem(){
      if(confirm("‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?")){
          localStorage.removeItem('madrasah_results_v2');
          location.reload();
      }
  }

  function downloadExcel() {
    let table = document.getElementById("final-table");
    let tempTable = table.cloneNode(true);
    tempTable.querySelectorAll(".action-col").forEach(c => c.remove());
    
    let html = `
      <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel">
        <head><meta charset="UTF-8"></head>
        <body>
            <h3>${examInfo.class} - ${examInfo.name} ${examInfo.year}</h3>
            ${tempTable.outerHTML}
        </body>
      </html>`;
    
    let blob = new Blob(['\ufeff', html], { type: 'application/vnd.ms-excel' });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `Result_${examInfo.class}.xls`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
</script>
</body>
</html>
